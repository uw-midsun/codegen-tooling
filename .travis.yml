notifications:
  email: false

dist: trusty

language: python

python:
  - "2.7"
  - "3.3"
  - "3.4"

# enable "Build pushes" and "Build pull requests" in Travis CI
# - pull requests will always be built
# - only build pushes to master
branches:
  only:
    - master

before_install:
  - sudo apt-get -qq update

install:
  - pip install -r requirements.txt
  - wget https://github.com/google/protobuf/releases/download/v3.4.0/protoc-3.4.0-linux-x86_64.zip
  - unzip protoc-3.4.0-linux-x86_64.zip
  - export PATH="${TRAVIS_BUILD_DIR}/bin:$PATH"
  - wget http://releases.llvm.org/5.0.1/clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-14.04.tar.xz
  - tar -xJf clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-14.04.tar.xz
  - export PATH="${TRAVIS_BUILD_DIR}/clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-14.04/bin:$PATH"

script:
  - make lint
  - make test
  - make gen

before_deploy:
  - zip codegen-tooling-out.zip out/*

deploy:
  provider: releases
  api_key:
    secure: L771x98NsBBWYdTHds9PUPL0uhtpbb3Sl3hLVt14Pssz6NbuuEYTaueQSEAhDbcdxaLWkAoZeEyLoZ30qZX/P8TzFdBGAsm6AnEh7nbqLKruMr/3SpNSEmT0V8v0pgXVVaev6Nw5dFFtinjdgaUlP9dwYugcTzKaPPStE02HyJB6r06WSdhSOxiX1+/HcDhjr+kg/pChHOlEjcbFE7QaRY6dvIZNFpa2O2JLjd1AbnZ9DhTfI/xtgbtLehc8lNUfNrxRPjR8qcYWwY6ni8/BVVrlPU/G8U50iXesswsmJtjb/7qoZEmacIKm4OmFSjXUu8QBHU29Ccz+ZypeMC1rEH11yL9pyOoJeHp/VdiO8HCeVr4oP5QedKaT7LT/dIoMhaoCt0gt1xQehJwsl1VdA8n+xAvBRANfA6O1nCa2B/joODEocCWWYtf0TWsW+psCykD52B6MLDJzsXZeaTbnrq2rscNXpx0MDAgf8d5ttw0ODaQ+ZO59sz9ghUMAA8wIyeg2cuLG5o2mdLsq85044NUxXim9tOO3ijje7OrWrk3AagzM/57gG0V+tupG7qoEZ9AnSpon0xsjBKByp2DcxfsWhMFyVG2bxVbSYxcqIgGYIroNNpfYKmgc2dyK2fiPuHa3z1Xr8oijVviFvSbca4wC/F/hd2xAajNehbAUaHU=
  file:
    - codegen-tooling-out.zip
  skip_cleanup: true
  on:
    repo: uw-midsun/codegen-tooling
    tags: true
